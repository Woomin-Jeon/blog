---
title: 2020-04-23 TIL
date: 2020-04-23
category: "All"
draft: true
---

## Facts

- AWS S3에 버킷을 새로 파서 multer 라이브러리를 이용하는 방법으로 이미지 파일 업로드 방식을 바꾸었습니다. 이 과정에서 에러가 나서 고생했었는데, 원인은 이전에 multer 라이브러리 말고 express-fileuploader라는 라이브러리를 썼었는데, 이 라이브러리가 먼저 이미지 파일에 대한 request를 캐치해서 발생한 것이었습니다.
- socket.io에 대한 배포도 완료하였습니다. 배포하고나니 socket.io가 연결이 되지 않았었는데, 그 원인은 docker container에서 7000번 포트만 열어줬기 때문에 socket.io가 listening하고 있는 6000번 포트로는 아무것도 들어갈 수 없었기 때문이었습니다. 그렇기 때문에 docker container에서 포트를 두 개 열어주는 방법을 찾아보았는데 없는 것 같아서 socket.io 용으로 constainer를 하나 더 띄웠습니다. 그랬는데도 6000번으로 연결이 되지 않는 문제가 있었습니다. 이 때문에 정말 애먹었는데 결국 이유는 포트번호 6000번이 이미 Linux OS가 다른 용도로 할당해주는 포트번호였기 때문이었습니다. 그래서 포트번호를 4000번으로 바꾼 뒤 다시 socket.io container를 띄웠더니 잘 동작하였습니다.
- 마지막으로 배포 후 제 프로젝트에서 세션유지가 안되는 문제점을 해결하고자 하였는데, 결국 끝까지는 해결 못하고 하루가 끝났습니다.

## Feelings

- 배포가 이렇게 어려운 것인지 몰랐습니다. 제 로컬에서 돌아갔던 프로그램들이 다른 환경으로 가니까 세세하게 변경해주어야 하는 것들이 많아지네요.

## Findings

- AWS S3를 이용해서 이미지 파일을 업로드하고 내려받는 방법에 대해 익혔습니다. 원래는 엄청 부담스러웠었는데 막상 하고나니 정말 간편하고 좋네요.
- 포트번호는 유의해서 설정해주어야 합니다.

## Future Action Plans

- 다음 프로젝트부터는 배포환경을 갖추어 놓은 상태에서부터 시작을 하는 게 올바를 것 같습니다.

## Feedback

- OK
